Medicare Provider Charge
========================

Last update by Benjamin Chan (<benjamin.ks.chan@gmail.com>) on `r paste(Sys.time())` using `r R.version.string`.

Analyze CMS Medicare Provider Charge public use dataset. The data is documented and can be downloaded at the Medicare Provider Charge Data [website](http://www.cms.gov/Research-Statistics-Data-and-Systems/Statistics-Trends-and-Reports/Medicare-Provider-Charge-Data/index.html).

> As part of the Obama administrationâ€™s work to make our health care system more affordable and accountable, data are being released that show significant variation across the country and within communities in what hospitals charge for common inpatient services.

> The data provided here include hospital-specific charges for the more than 3,000 U.S. hospitals that receive Medicare Inpatient Prospective Payment System (IPPS) payments for the top 100 most frequently billed discharges, paid under Medicare based on a rate per discharge using the Medicare Severity Diagnosis Related Group (MS-DRG) for Fiscal Year (FY) 2011. These DRGs represent almost 7 million discharges or 60 percent of total Medicare IPPS discharges.

> Hospitals determine what they will charge for items and services provided to patients and these charges are the amount the hospital bills for an item or service. The Total Payment amount includes the MS-DRG amount, bill total per diem, beneficiary primary payer claim payment amount, beneficiary Part A coinsurance amount, beneficiary deductible amount, beneficiary blood deducible amount and DRG outlier amount.

> For these DRGs, average charges and average Medicare payments are calculated at the individual hospital level. Users will be able to make comparisons between the amount charged by individual hospitals within local markets, and nationwide, for services that might be furnished in connection with a particular inpatient stay.

--------------------------------------------------------------------------------

Load the required libraries.
```{r LoadLibraries, results='hide'}
require(RCurl, quietly=TRUE)
require(xtable, quietly=TRUE)
require(ggplot2, quietly=TRUE)
require(scales, quietly=TRUE)
require(RColorBrewer, quietly=TRUE)
```


RCurl with https is being tempermental. Copy the dataset to the local folder and `read.table` from there. Read the entire dataset. 
```{r ReadData}
# url <- getURL("https://dl.dropboxusercontent.com/u/386956/Medicare_Provider_Charge_Inpatient_DRG100_FY2011.csv")
# df <- read.csv(textConnection(url), header=TRUE, sep=",")
df <- read.csv("Medicare_Provider_Charge_Inpatient_DRG100_FY2011.csv", header=TRUE, sep=",")
```
Create some new fields.
```{r MassageData}
df$DRGnum <- as.numeric(substr(df$DRG.Definition, 1, 3))
df$DRGlab <- substr(df$DRG.Definition, 7, max(nchar(as.character(df$DRG.Definition))))
df$OHSU <- grepl("^OHSU", df$Provider.Name)
```
Show the number of rows, the field names, and the first few rows.
```{r PeekAtDataset}
nrow(df)
names(df)
head(df)
```

Create geographic subsets of
* Oregon providers
* Portland metro providers
* OHSU
```{r CreateGeographicSubsets}
dfOR <- subset(df, Provider.State=="OR")
dfPDXMetro <- df[grep("^OR - Portland", df$Hospital.Referral.Region.Description),]
dfOHSU <- df[grep("^OHSU", df$Provider.Name),]
```
Not all DRGs are in the dataset. List the DRGs that are reported for OHSU. DRGs with a *1* to the right are those reported for OHSU
```{r ListDRGs, results='asis'}
print(xtable(table(dfOHSU$DRG.Definition)), type="html")
```


Create MDC subsets.
```{r CreateMDCSubsets}
dfMDC01S <- subset(df, 020 <= DRGnum & DRGnum <= 042)
dfMDC02S <- subset(df, 113 <= DRGnum & DRGnum <= 117)
dfMDC03S <- subset(df, 129 <= DRGnum & DRGnum <= 139)
dfMDC04S <- subset(df, 163 <= DRGnum & DRGnum <= 168)
dfMDC05S <- subset(df, 215 <= DRGnum & DRGnum <= 265)
dfMDC06S <- subset(df, 326 <= DRGnum & DRGnum <= 358)
dfMDC07S <- subset(df, 405 <= DRGnum & DRGnum <= 425)
dfMDC08S <- subset(df, 453 <= DRGnum & DRGnum <= 517)
dfMDC09S <- subset(df, 570 <= DRGnum & DRGnum <= 585)
dfMDC10S <- subset(df, 614 <= DRGnum & DRGnum <= 630)
dfMDC11S <- subset(df, 652 <= DRGnum & DRGnum <= 675)
dfMDC12S <- subset(df, 707 <= DRGnum & DRGnum <= 718)
dfMDC13S <- subset(df, 734 <= DRGnum & DRGnum <= 750)
dfMDC14S <- subset(df, 765 <= DRGnum & DRGnum <= 770)
dfMDC16S <- subset(df, 799 <= DRGnum & DRGnum <= 804)
dfMDC21S <- subset(df, 901 <= DRGnum & DRGnum <= 909)
dfMDC22S <- subset(df, 927 <= DRGnum & DRGnum <= 934)
```

Create function for violin plotting.
```{r DefineFunction}
Violin <- function(d, title) {
  ggplot(d, aes(x=factor(DRGnum), y=Average.Covered.Charges, fill=OHSU, color=OHSU)) +
    geom_violin(alpha=1/2) +
    scale_y_log10(breaks=c(1E4, 2E4, 4E4, 8E4, 16E4, 32E4), labels=c("$10K", "$20K", "$40K", "$80K", "$160K", "$320K")) +
    scale_fill_discrete("Provider", label=c("non-OHSU", "OHSU")) +
    scale_color_discrete("Provider", label=c("non-OHSU", "OHSU")) +
    labs(title=paste(title, "Nationwide", sep="\n"), x="DRG", y="Average Covered Charges") +
    theme(legend.position="bottom")
}
```

Violin plots for surgical DRGs by MDC.
```{r ViolinMDC01S}
Violin(dfMDC01S, "MDC 01 Diseases & disorders of the nervous system")
```
```{r ViolinMDC02S, eval=FALSE}
Violin(dfMDC02S, "MDC 02 Diseases & disorders of the eye")
```
```{r ViolinMDC03S, eval=FALSE}
Violin(dfMDC03S, "MDC 03 Diseases & disorders of the ear, nose, mouth & throat")
```
```{r ViolinMDC04S, eval=FALSE}
Violin(dfMDC04S, "MDC 04 Diseases & disorders of the respiratory system")
```
```{r ViolinMDC05S}
Violin(dfMDC05S, "MDC 05 Diseases & disorders of the circulatory system")
```
```{r ViolinMDC06S}
Violin(dfMDC06S, "MDC 06 Diseases & disorders of the digestive system")
```
```{r ViolinMDC07S}
Violin(dfMDC07S, "MDC 07 Diseases & disorders of the hepatobiliary system & pancreas")
```
```{r ViolinMDC08S}
Violin(dfMDC08S, "MDC 08 Diseases & disorders of the musculoskeletal system & connective tissue")
```
```{r ViolinMDC09S, eval=FALSE}
Violin(dfMDC09S, "MDC 09 Diseases & disorders of the skin, subcutaneous tissue & breast")
```
```{r ViolinMDC10S, eval=FALSE}
Violin(dfMDC10S, "MDC 10 Endocrine, nutritional & metabolic diseases & disorders")
```
```{r ViolinMDC11S, eval=FALSE}
Violin(dfMDC11S, "MDC 11 Diseases & disorders of the kidney & urinary tract")
```
```{r ViolinMDC12S, eval=FALSE}
Violin(dfMDC12S, "MDC 12 Diseases & disorders of the male reproductive system")
```
```{r ViolinMDC13S, eval=FALSE}
Violin(dfMDC13S, "MDC 13 Diseases & disorders of the female reproductive system")
```
```{r ViolinMDC14S, eval=FALSE}
Violin(dfMDC14S, "MDC 14 Pregnancy, childbirth & the puerperium")
```
```{r ViolinMDC16S, eval=FALSE}
Violin(dfMDC16S, "MDC 16 Disease & disorders of blood, blood forming organs, immunologic disorders")
```
```{r ViolinMDC21S, eval=FALSE}
Violin(dfMDC21S, "MDC 21 Injuries, poisonings & toxic effects of drugs")
```
```{r ViolinMDC22S, eval=FALSE}
Violin(dfMDC22S, "MDC 22 Burns")
```
